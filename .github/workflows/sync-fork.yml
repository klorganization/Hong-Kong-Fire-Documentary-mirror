name: Sync Fork (Using fork-sync action)

on:
  schedule:
    # Run every hour at minute 0
    - cron: '0 * * * *'
  # Allow manual trigger
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Sync upstream changes
        uses: tgymnich/fork-sync@v2
        with:
          # GitHub token with repo permissions
          token: ${{ secrets.GITHUB_TOKEN }}
          
          # Owner of the upstream repository
            # Replace with actual upstream owner
          owner: Hong-Kong-Emergency-Coordination-Hub
          
          # Name of the upstream repository
          # Replace with actual upstream repo name
          repo: Hong-Kong-Fire-Documentary
          
          # Branch to sync (default is main)
          # You can specify multiple branches separated by commas
          base: main
          
          # Head branch (your fork's branch)
          head: main
          
          # Merge method: merge, squash, or rebase (default is merge)
          merge_method: merge
      
      - name: Add [skip ci] to commit message
        if: github.event_name == 'push' || github.event_name == 'schedule'
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Check if there are new commits
          if git log -1 --pretty=%B | grep -q "Merge pull request"; then
            # Amend the commit message to add [skip ci]
            git commit --amend -m "[skip ci] $(git log -1 --pretty=%B)"
            git push -f origin main
          fi